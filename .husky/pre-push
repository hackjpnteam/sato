#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-push checks..."

# Lint check
echo "ğŸ“‹ Running ESLint..."
npm run lint || { echo "âŒ Lint failed"; exit 1; }

# Guard: request.cookies ç¦æ­¢
echo "ğŸš« Checking for forbidden request.cookies usage..."
if grep -R "request\.cookies" -n app src pages 2>/dev/null; then
  echo "âŒ ERROR: request.cookies found. Use cookies() from next/headers instead"
  exit 1
fi

# Guard: req.cookies.get æ¤œå‡º
echo "ğŸš« Checking for forbidden req.cookies.get usage..."
if grep -R "\.cookies\.get(" -n app src pages 2>/dev/null | grep -v 'from "next/headers"'; then
  echo "âŒ ERROR: req.cookies.get usage found. Use cookies() from next/headers instead"
  exit 1
fi

# Build check
echo "ğŸ—ï¸ Running build check..."
npm run build || { echo "âŒ Build failed"; exit 1; }

echo "âœ… All pre-push checks passed!"